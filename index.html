<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Ember Ledger</title>
  <meta name="description" content="A tiny fantasy-themed website with a quest board, dice roller, name forge, and more. 100% offline-capable.">
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Spectral:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0e14; --fg:#e8e6df; --muted:#b2b6c0; --accent:#c084fc;
      --card:rgba(255,255,255,.06); --border:rgba(255,255,255,.12); --glow:rgba(192,132,252,.5);
    }
    .light{ --bg:#f8f7f3; --fg:#1d1c1a; --muted:#5a5e66; --card:rgba(0,0,0,.04); --border:rgba(0,0,0,.08); --glow:rgba(147,197,253,.5) }
    *{box-sizing:border-box}
    html, body { color-scheme: dark light; }
    .light { color-scheme: light dark; }

    body{margin:0; font-family:'Spectral',serif; background:var(--bg); color:var(--fg); line-height:1.6}
    header{position:sticky; top:0; backdrop-filter:saturate(1.2) blur(6px); background:linear-gradient( to right, rgba(0,0,0,.3), rgba(0,0,0,.1)); border-bottom:1px solid var(--border); z-index:10}
    .container{max-width:1050px; padding:1rem; margin:0 auto}
    .brand{font-family:'UnifrakturMaguntia',cursive; font-size:clamp(1.3rem,2vw + 1rem,2.1rem)}
    nav a{margin-right:1rem; color:var(--fg); text-decoration:none; opacity:.85} nav a:hover{opacity:1; text-decoration:underline; text-underline-offset:4px}
    .hero{position:relative; padding:6rem 0 4rem; overflow:hidden; border-bottom:1px solid var(--border)}
    .hero h1{font-family:'UnifrakturMaguntia',cursive; font-size:clamp(2rem,5vw + 1rem,4rem); margin:0 0 .5rem}
    .button{display:inline-block; padding:.7rem 1rem; border-radius:999px; border:1px solid var(--border); background:linear-gradient(180deg, var(--card), transparent); color:var(--fg); text-decoration:none; cursor:pointer; box-shadow:0 0 0 .5px var(--border), 0 10px 25px -15px var(--glow)}
    .grid{display:grid; gap:1rem}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:1rem; box-shadow:0 10px 30px -20px rgba(0,0,0,.5)}
    label{display:block; font-weight:600; margin:.5rem 0 .2rem}
    input[type="text"],input[type="number"],select{width:100%; padding:.6rem .7rem; border-radius:12px; border:1px solid var(--border); background:transparent; color:var(--fg)}
    hr.sep{border:0; height:1px; background:var(--border); margin:2rem 0}
    footer{border-top:1px solid var(--border); padding:2rem 0; margin-top:2rem}
    .switch{display:inline-flex; align-items:center; gap:.5rem}
    .switch input{appearance:none; width:46px; height:26px; background:var(--card); border:1px solid var(--border); border-radius:999px; position:relative; cursor:pointer}
    .switch input::after{content:''; position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:50%; background:var(--fg); transition:transform .2s}
    .switch input:checked::after{transform:translateX(20px)}
    #sky,#fog{position:absolute; inset:0; z-index:-1}
    #sky{background:radial-gradient(600px 300px at 50% -10%, rgba(255,255,255,.15), transparent), radial-gradient(800px 400px at 10% 10%, rgba(192,132,252,.15), transparent), radial-gradient(800px 400px at 90% 15%, rgba(96,165,250,.12), transparent)}
    #fog{background:radial-gradient(700px 200px at 30% 120%, rgba(255,255,255,.06), transparent), radial-gradient(700px 200px at 70% 120%, rgba(255,255,255,.06), transparent); filter:blur(10px); animation:drift 20s linear infinite alternate}
    @keyframes drift{to{transform:translateY(20px)}}
    .muted{color:var(--muted)}
    .flash{box-shadow:0 0 0 2px var(--glow) inset}

    /* High-contrast select for Name Forge (works in dark mode) */
    #raceSelect, #raceSelect option { background:#ffffff !important; color:#111111 !important; }
    #raceSelect { border-color: #d0d0d0; }
    
    /* Quest management UI */
    .quest-actions { display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.8rem }
    .quest-input { flex:1 1 320px; min-width:240px; max-width:640px }
    li.quest-card { position: relative; padding-right: 2rem; }
    .quest-del { position:absolute; right:.25rem; top:.25rem; border:none; background:transparent; color:var(--muted); cursor:pointer; font-size:1rem; line-height:1; }
    .quest-del:hover { color: var(--fg); }
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="grid" style="align-items:center">
      <div class="brand">The Ember Ledger</div>
      <nav style="justify-self:end">
        <a href="#quests">Quests</a>
        <a href="#dice">Dice</a>
        <a href="#names">Name Forge</a>
        <a href="#backstory">Backstory</a>
        <a href="#map">Map</a>
        <span class="switch"><input id="themeToggle" type="checkbox" role="switch" aria-label="Toggle theme"></span>
      </nav>
    </div>
  </div>
</header>

<section class="hero">
  <div id="sky"></div><div id="fog"></div>
  <div class="container">
    <h1>Welcome, traveler.</h1>
    <p>Everything on this page is offline-capable. Click the buttons and have fun ‚ú®</p>
    <a class="button" href="#quests">Begin your quest</a>
  </div>
</section>

<main class="container">
  <!-- Quests -->
  <section id="quests" class="grid">
    <div class="card">
      <h3>Quest Board</h3>
      <label for="questSearch">Search</label>
      <input id="questSearch" type="text" placeholder="Type to filter quests‚Ä¶ (e.g., dragon, ruins)">
      <ul id="questList">
        <li class="quest-card">Investigate the <strong>whispering ruins</strong> by the moonlit fen.</li>
        <li class="quest-card">Broker peace between the <strong>Ember Guild</strong> and the river wardens.</li>
        <li class="quest-card">Recover the <strong>Obsidian Keystone</strong> from the ash tunnels.</li>
        <li class="quest-card">Escort a caravan through the <strong>Wyrmwood</strong> after sundown.</li>
      </ul>
      <div class="quest-actions">
        <input id="questInput" class="quest-input" type="text" placeholder="Write a quest‚Ä¶ e.g., Track a lantern revenant near Stormglass Cliffs.">
        <button class="button" id="addQuestBtn">Add quest</button>
        <button class="button" id="genQuest">Random (local)</button>
        <button class="button" id="genQuest3">+3</button>
        <button class="button" id="clearQuestsBtn" title="Remove all quests">Clear all</button>
      </div>
    </div>
  </section>

  <hr class="sep">

  <!-- Dice -->
  <section id="dice" class="grid">
    <div class="card">
      <h3>Dice Roller</h3>
      <div style="display:flex; gap:.5rem; flex-wrap: wrap; margin:.5rem 0">
        <button class="button die" data-sides="4">d4</button>
        <button class="button die" data-sides="6">d6</button>
        <button class="button die" data-sides="8">d8</button>
        <button class="button die" data-sides="10">d10</button>
        <button class="button die" data-sides="12">d12</button>
        <button class="button die" data-sides="20">d20</button>
        <button class="button die" data-sides="100">d100</button>
      </div>
      <label for="diceCount">Number of dice</label>
      <input id="diceCount" type="number" min="1" max="20" value="1">
      <label for="diceSides">Custom sides (optional)</label>
      <input id="diceSides" type="number" min="2" max="1000" placeholder="e.g., 7">
      <div aria-live="polite" id="diceOutput" style="margin-top:.8rem"></div>
    </div>
  </section>

  <hr class="sep">

  <!-- Names -->
  <section id="names" class="grid">
    <div class="card">
      <h3>Name Forge</h3>
      <label for="raceSelect">Style</label>
      <select id="raceSelect" aria-label="Select name style">
        <option value="elf">Elf</option>
        <option value="dwarf">Dwarf</option>
        <option value="human">Human</option>
        <option value="lizardfolk">Lizardfolk</option>
        <option value="orc">Orc</option>
      </select>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.6rem">
        <button class="button" id="genName">Forge Name</button>
        <button class="button" id="genNameApi">Forge via API (web)</button>
      </div>
      <div id="nameOut" aria-live="polite" style="margin-top:.8rem; font-size:1.25rem"></div>
    </div>
  </section>

  <hr class="sep">

  <!-- Backstory -->
  <section id="backstory" class="grid">
    <div class="card">
      <h3>Backstory Forge</h3>
      <p class="muted">Pick a race and class. We‚Äôll stitch a one-paragraph seed locally.</p>
      <label for="backRace">Race</label>
      <select id="backRace">
        <option>Human</option><option>Elf</option><option>Dwarf</option><option>Orc</option><option>Lizardfolk</option>
      </select>
      <label for="backClass">Class</label>
      <select id="backClass">
        <option>Barbarian</option><option>Bard</option><option>Cleric</option><option>Druid</option><option>Fighter</option><option>Monk</option><option>Paladin</option><option>Ranger</option><option>Rogue</option><option>Sorcerer</option><option>Warlock</option><option>Wizard</option>
      </select>
      <button class="button" id="genBack" style="margin-top:.6rem">Forge Backstory</button>
      <div id="backOut" aria-live="polite" style="margin-top:.8rem"></div>
    </div>
  </section>

  <hr class="sep">

  <!-- Map -->
  <section id="map" class="grid">
    <div class="card">
      <h3>Pocket Map</h3>
      <details open>
        <summary>üïØÔ∏è The Lantern Market</summary>
        A tangle of alleys where glassblowers sell bottled starlight.
      </details>
      <details>
        <summary>üçÉ Wyrmwood Edge</summary>
        Owls whisper warnings. Travelers leave offerings of copper.
      </details>
      <details>
        <summary>‚õ∞Ô∏è The Ash Tunnels</summary>
        Lava-scarred caverns where the Obsidian Keystone once lay.
      </details>
      <details>
        <summary>üèõÔ∏è Oniron Archives</summary>
        Stacks of vellum. Librarians measure time by candle height.
      </details>
    </div>
  </section>
</main>

<footer>
  <div class="container grid">
    <div><small class="muted">¬© <span id="year"></span> Your Name. HTML + CSS + vanilla JS.</small></div>
    <div style="justify-self:end"><a class="button" href="#top">Back to top</a></div>
  </div>
</footer>

<script>
  // ===== Theme =====
  (function(){
    var root = document.documentElement;
    var t = document.getElementById('themeToggle');
    var saved = localStorage.getItem('theme');
    if (saved === 'light'){ root.classList.add('light'); if (t){ t.checked = true; } }
    if (t) t.addEventListener('change', function(){
      var isLight = !!t.checked;
      if (isLight) root.classList.add('light'); else root.classList.remove('light');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    });
  })();

  // ===== Data (local) =====
  (function(){
    window.NAMES = {
      elf:["Elaith","Larethian","Faelar","Aeris","Sylvara","Thalanil","Nymeria","Aelar","Syllin","Vaelis"],
      dwarf:["Brom","Torunn","Hilda","Durik","Kazgrim","Brunhild","Rurik","Gimra","Thrain","Mavda"],
      human:["Alaric","Seraphine","Garrick","Rowan","Mira","Corvin","Elara","Tristan","Sabine","Dorian"],
      lizardfolk:["Sszark","Vresh","Thri'kash","Isskra","Zerith","Ressik","Sarraka","Kravax","Thozra","Vek"],
      orc:["Grom","Urga","Sharn","Vrusk","Magra","Thok","Zugra","Brakka","Orzul","Grishnak"]
    };
    window.LOCS = ["the Lantern Market","Wyrmwood Edge","the Ash Tunnels","the Oniron Archives","the Moonfen","Stormglass Cliffs","the Ember Docks"];
    window.MONSTERS = ["ember wraith","glass basilisk","moonfen lurker","ash-tunnel troll","wyrmwood stalker","stormglass harpy","lantern revenant"];
    window.VERBS = ["Hunt","Investigate","Protect","Recover","Escort","Disrupt","Track"];
    window.MEMENTOS = ["a soot-stained locket","a shard of black glass","a riverwarden badge","a lantern with cracked glass","a brass coin with a bite mark"];
    window.THREADS = ["a promise you failed to keep","a debt owed to the Ember Guild","a map fragment you can‚Äôt translate","dreams of ash and bells","a friend who never returned"];
    window.pick = function(a){ return a[Math.floor(Math.random()*a.length)]; };
  })();

  // ===== Quest filter =====
  (function(){
    var search = document.getElementById('questSearch');
    var list = document.getElementById('questList');
    if (!search || !list) return;
    search.addEventListener('input', function(){
      var q = (search.value || '').toLowerCase();
      var items = list.querySelectorAll('.quest-card');
      for (var i=0;i<items.length;i++){
        var li = items[i];
        var show = li.textContent.toLowerCase().indexOf(q) !== -1;
        li.style.display = show ? '' : 'none';
      }
    });
  })();

  // ===== Dice roller =====
  (function(){
    var output = document.getElementById('diceOutput');
    var countInput = document.getElementById('diceCount');
    var sidesInput = document.getElementById('diceSides');
    var lastTotal = null;
    if (!output || !countInput) return;
    function rollDie(s){ return Math.floor(Math.random()*s)+1; }
    function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }
    function roll(s){
      var n = parseInt(countInput.value || '1',10); if (isNaN(n)) n = 1; n = clamp(n,1,20);
      var rolls = [], total = 0;
      for (var i=0;i<n;i++){ var r = rollDie(s); rolls.push(r); total += r; }
      output.innerHTML = "<strong>"+n+"√ód"+s+"</strong>: "+rolls.join(", ")+" ‚Äî <strong>total "+total+"</strong>"+(lastTotal!==null?" (prev "+lastTotal+")":"");
      lastTotal = total;
    }
    var btns = document.querySelectorAll('.die');
    for (var i=0;i<btns.length;i++){
      (function(b){ b.addEventListener('click', function(){ roll(parseInt(b.getAttribute('data-sides'),10)); }); })(btns[i]);
    }
    document.addEventListener('keydown', function(e){
      var map = {'1':4,'2':6,'3':8,'4':10,'5':12,'6':20,'7':100};
      if (map[e.key]) roll(map[e.key]);
    });
    if (sidesInput) sidesInput.addEventListener('change', function(){ var s=parseInt(sidesInput.value,10); if (s>=2) roll(s); });
  })();

  // ===== Name forge (local) =====
  (function(){
    var race = document.getElementById('raceSelect');
    var btn = document.getElementById('genName');
    var out = document.getElementById('nameOut');
    if (!btn || !race || !out) return;
    btn.addEventListener('click', function(){
      var set = (window.NAMES && window.NAMES[race.value]) || window.NAMES.human;
      out.textContent = window.pick(set);
    });
  })();

  // ===== Name forge (public API) =====
  (function(){
    var btn = document.getElementById('genNameApi');
    var race = document.getElementById('raceSelect');
    var out = document.getElementById('nameOut');
    if (!btn || !race || !out) return;
    function fallback(){
      var set = (window.NAMES && window.NAMES[race.value]) || window.NAMES.human || ['Traveler'];
      out.textContent = window.pick(set);
    }
    btn.addEventListener('click', function(){
      out.textContent = "Forging‚Ä¶";
      var map = { human:'h', dwarf:'d', elf:'e', orc:'o', lizardfolk:'h' };
      var a = map[race.value] || 'h';
      var url = 'https://fantasyname.lukewh.com/?family=t&ancestry=' + a;
      fetch(url, {mode:'cors'})
        .then(function(res){ return res.text(); })
        .then(function(txt){
          var cleaned = (txt||'').replace(/\r?\n/g,' ').trim();
          if (cleaned) out.textContent = cleaned; else fallback();
        })
        .catch(fallback);
    });
  })();

  // ===== Quest generator + manage (add/delete/persist) =====
  (function(){
    var list = document.getElementById('questList');
    var addBtn = document.getElementById('addQuestBtn');
    var input = document.getElementById('questInput');
    var randBtn = document.getElementById('genQuest');
    var rand3Btn = document.getElementById('genQuest3');
    var clearBtn = document.getElementById('clearQuestsBtn');
    if (!list) return;

    function attachDelButton(li){
      var b = document.createElement('button');
      b.className = 'quest-del';
      b.setAttribute('aria-label','Delete quest');
      b.title = 'Delete';
      b.textContent = '√ó';
      b.addEventListener('click', function(){ li.remove(); save(); });
      li.appendChild(b);
    }
    function save(){
      var arr = []; var items = list.querySelectorAll('li.quest-card');
      for (var i=0;i<items.length;i++){ arr.push(items[i].innerHTML); }
      try{ localStorage.setItem('quests_v1', JSON.stringify(arr)); }catch(e){}
    }
    function render(arr){
      list.innerHTML = '';
      for (var i=0;i<arr.length;i++){
        var li = document.createElement('li');
        li.className = 'quest-card';
        li.innerHTML = arr[i];
        attachDelButton(li);
        list.appendChild(li);
      }
    }
    function load(){
      var stored = null; try{ stored = JSON.parse(localStorage.getItem('quests_v1') || 'null'); }catch(e){}
      if (stored && Array.isArray(stored) && stored.length){ render(stored); }
      else {
        var items = list.querySelectorAll('li.quest-card');
        for (var i=0;i<items.length;i++){ attachDelButton(items[i]); }
        save();
      }
    }
    function addText(text){
      var t = (text||'').trim(); if (!t) return;
      var li = document.createElement('li'); li.className = 'quest-card';
      li.textContent = t; attachDelButton(li); list.prepend(li); save(); if (input) input.value='';
    }
    function randomQuest(){
      var verb = window.pick(window.VERBS);
      var mon = window.pick(window.MONSTERS);
      var place = window.pick(window.LOCS);
      var li = document.createElement('li'); li.className = 'quest-card';
      li.innerHTML = verb + ' a <strong>' + mon + '</strong> near <strong>' + place + '</strong>.';
      attachDelButton(li); list.prepend(li); save();
    }

    if (addBtn && input) addBtn.addEventListener('click', function(){ addText(input.value); });
    if (input) input.addEventListener('keydown', function(e){ if (e.key === 'Enter') addText(input.value); });
    if (randBtn) randBtn.addEventListener('click', randomQuest);
    if (rand3Btn) rand3Btn.addEventListener('click', function(){ randomQuest(); randomQuest(); randomQuest(); });
    if (clearBtn) clearBtn.addEventListener('click', function(){ if (confirm('Clear all quests?')){ list.innerHTML=''; save(); }});

    load();
  })();

  // ===== Backstory generator (local) =====
  (function(){
    var btn = document.getElementById('genBack');
    var out = document.getElementById('backOut');
    var race = document.getElementById('backRace');
    var klass = document.getElementById('backClass');
    if (!btn || !out) return;
    btn.addEventListener('click', function(){
      var m = window.pick(window.MEMENTOS);
      var t = window.pick(window.THREADS);
      var para = "You are a " + race.value.toLowerCase() + " " + klass.value.toLowerCase() +
        " who learned to read the wind along alley-rows and ash tunnels. You carry " + m +
        " and follow " + t + ". The Lantern Market remembers your name‚Äîwhether in whispers or in songs depends on what you do next.";
      out.textContent = para;
    });
  })();

  // ===== Misc =====
  (function(){
    var y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
    var anchors = document.querySelectorAll('a[href^="#"]');
    for (var i=0;i<anchors.length;i++){
      (function(a){
        a.addEventListener('click', function(e){
          var id = a.getAttribute('href').slice(1);
          var target = document.getElementById(id);
          if (target){ e.preventDefault(); target.scrollIntoView({behavior:'smooth', block:'start'}); target.classList.add('flash'); setTimeout(function(){target.classList.remove('flash');},600); }
        });
      })(anchors[i]);
    }
  })();
</script>
</body>
</html>
